<!DOCTYPE=html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="title" content="Nmon.io Dashboard - Dashboard, Report and Analyze service for your nmon data">
    <meta name="description" content="nmon. website providing nmon dashboard, report and analyze service in cloud">
    <meta name="keywords" content="Nmon,nmon analyzer,nmon report,Linux,AIX,Solaris,sarmon,topas_nmon,server,database server">
    <meta name="author" content="Junkoo Hea">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script type="text/javascript"
          src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart']
            }]
          }"></script>
    <script type="text/javascript">
        function getHosts(category) {
                $.ajax({
                url: "/All/" + category + "/hosts",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    var html = '<option value="All">All</option>';
                    for (var i = 0; i < result.length; i++) {
                        html += '<option value="' + result[i] + '">' + result[i] + '</option>';
                    }
                    $("#hosts").html(html);
                }
            });
        }

        function drawChart(did, x, y, label, row, stack) {
            var data = new google.visualization.DataTable();
            data.addColumn('datetime', x);
            for(var i = 0; i < y.length; i++) {
                data.addColumn('number', y[i]);
            }
            for(var i = 0; i < row.length; i++) {
                row[i][0] = new Date(row[i][0]);
            }
            data.addRows(row);

            var options = {
                vAxis: { title : label },
                isStacked: stack,
                chartArea: {  width: "75%", height : '80%' },
            };

            var chart = new google.visualization.AreaChart(document.getElementById(did));
            chart.draw(data, options);
        }

        function drawPieChart(did, data, title) {
            var data = google.visualization.arrayToDataTable(data);

            var options = {
                title: title,
                pieSliceText: 'label',
                pieHole: 0.4,
                chartArea: {  width: "95%", height : '85%' }
            };

            var chart = new google.visualization.PieChart(document.getElementById(did));
            chart.draw(data, options);
        }

        function updateGraph(hostname, fromDate, toDate) {
            console.log(fromDate + " " + fromDate.getTime());
            console.log(toDate + " " + toDate.getTime());

            var start = +new Date();
            // cpu
            $.ajax({
                url: "/" + hostname + "/CPU_ALL?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&data=['User%25', 'Sys%25', 'Wait%25']",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    drawChart("cpu_chart", "time", ['User%', 'Sys%', 'Wait%'], '%', result, true);
                    console.log('cpu chart :' + (+new Date() - start));
                }
            });

            // memory
            $.ajax({
                url: "/" + hostname + "/MEM?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&data=['Real total(MB)', 'Real free(MB)']",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    for(var i = 0; i < result.length; i++) {
                        result[i][2] = result[i][1] - result[i][2];
                    }
                    drawChart("mem_chart", "time", ['Real total(MB)', 'Real used(MB)'], 'MB', result, false);
                    console.log('mem chart :' + (+new Date() - start));
                }
            });

            // swap
            $.ajax({
                url: "/" + hostname + "/MEM?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&data=['Virtual total(MB)', 'Virtual free(MB)']",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    for(var i = 0; i < result.length; i++) {
                        result[i][2] = result[i][1] - result[i][2];
                    }
                    drawChart("swap_chart", "time", ['Virtual total(MB)', 'Virtual used(MB)'], 'MB', result, false);
                    console.log('swap chart :' + (+new Date() - start));
                }
            });

            // disk
            $.ajax({
                url: "/" + hostname + "/DISK_TOTAL?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&data=['read', 'write']",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    drawChart("disk_chart", "time", ['read', 'write'], 'KB/s', result, true);
                    console.log('disk chart :' + (+new Date() - start));
                }
            });

            // network
            $.ajax({
                url: "/" + hostname + "/NET_TOTAL?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&data=['read', 'write']",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    drawChart("network_chart", "time", ['read', 'write'], 'KB/s', result, true);
                    console.log('network chart :' + (+new Date() - start));
                }
            });

            // process (cpu)
            $.ajax({
                url: "/" + hostname + "/TOP?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&type=cpu",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    drawPieChart("process_cpu_chart", data, "CPU");
                    console.log('process (cpu) chart :' + (+new Date() - start));
                }
            });

            // process (mem)
            $.ajax({
                url: "/" + hostname + "/TOP?date=[" + fromDate.getTime() + "," + toDate.getTime() + "]&type=mem",
                data: {},
                success: function( data ) {
                    var result = eval(data);
                    drawPieChart("process_mem_chart", data, "MEM");
                    console.log('process (mem) chart :' + (+new Date() - start));
                }
            });
        }

        $(function() {
            getHosts('CPU_ALL');
            var today = new Date();
            $("#from").val((today.getMonth() + 1) + "/" + today.getDate() + "/" + today.getFullYear());
            $("#to").val("now");
            $("#view").click(function(event) {
                var fromDate, toDate;

                fromDate = new Date($("#from").val() + " " + $("#from_time").val());

                if ($("#to").val() !== "now")
                    toDate = new Date($("#to").val() + " " + $("#to_time").val());
                else
                    toDate = new Date();
                updateGraph($("#hosts").val(), fromDate, toDate)
            });
            var fromDate = new Date($("#from").val());
            var toDate = new Date();
            updateGraph('All', fromDate, toDate);
        });
    </script>
    <style>
      body {
	font-family: "Tahoma", "Helvetica", "Arial",  "Verdana", "sans-serif";
//	font-size: 62.5%;
      }

      text {
        font: 10px sans-serif;
      }

      .googlechart {
        border-size:1px;
        border-style:dotted;
        border-radius:10px;
        border-color:black;
        font-size:15px;
        padding:0px;
        margin-top:0px;
        margin-bottom:0px;
        margin-left:0px;
        margin-right:0px;
        width: 1024px;
        height: 576px;
      }

      .nmon_references {
        border-size:1px;
        border-style:dotted;
        border-radius:10px;
        border-color:black;
        font-size:15px;
        padding:0px;
        margin-top:0px;
        margin-bottom:0px;
        margin-left:0px;
        margin-right:0px;
        width: 1024px;
        height: 610px;
      }
    </style>
  <script>
    $(function() {
      $( "#from" ).datepicker({
        defaultDate: "-7m",
        changeMonth: true,
        changeYear: true,
        maxDate: "0",
        numberOfMonths: 1,
        selectOtherMonths: true,
        showOtherMonths: true,
        onClose: function( selectedDate ) {
          $( "#to" ).datepicker( "option", "minDate", selectedDate );
        }
      });
      $( "#to" ).datepicker({
        defaultDate: "0",
        changeMonth: true,
        changeYear: true,
        maxDate: "0",
        numberOfMonths: 1,
        selectOtherMonths: true,
        showOtherMonths: true,
        onClose: function( selectedDate ) {
          $( "#from" ).datepicker( "option", "maxDate", selectedDate );
        }
      });

      /*
       * TODO: This is just POC version
       *       Have to consider long days analysis
       *       1 time frame is 5 mins now.
       */
       $("#slider-range-date").slider({
        min: 0,
        max: 365*3,
        values: [0, 365*3 ],
        slide: function( event, ui ) {
        }
      });

      $( "#slider-range-time" ).slider({
        range: true,
        min: 0,
        max: 60*24*2/5,
        values: [ 96, 528 ],
        slide: function( event, ui ) {
          var min = 0, max = 60*24*2/5,
              hour = 0, hourstr, min = 0, minstr;

          if (ui.values[0] > max/2) {
            $( "#slider-range-time" ).slider("values", 0, max / 2);
            hour = max/2*5/60;
            ui.values[0] = max/2;

            // Just workaround, folowing refresh generates javascript error.
            // But, it works as I wanted... :-) youngmo 2015.8.16.
            $( "#slider-range-time" ).slider("refresh");
          } else { 
            hour = Math.floor(ui.values[0]*5/60);
          }
          if ( hour < 10 ) hourstr = "0" + hour;
          else hourstr = "" + hour;
          min = (ui.values[0]*5)%60;
          if ( min < 10 ) minstr = "0" + min;
          else minstr = "" + min;
          $( "#from_time" ).val( hourstr + ":" + minstr );

          if (ui.values[1] < max/2) {
            $( "#slider-range-time" ).slider("values", 1, max /2 );
            hour = max/2*5/60;
            ui.values[1] = max/2;
            // Just workaround, folowing refresh generates javascript error.
            // But, it works as I wanted... :-) youngmo 2015.8.16.
            $( "#slider-range-time" ).slider("refresh");
          } else {
            hour = Math.floor((ui.values[1]-max/2)*5/60);
          }
          if ( hour < 10 ) hourstr = "0" + hour;
          else hourstr = "" + hour;
          min = ((ui.values[1]-max/2)*5)%60
          if ( min < 10 ) minstr = "0" + min;
          else minstr = "" + min;
          $(   "#to_time" ).val( hourstr + ":" + minstr );
        }
      });
      $( "#from_time" ).val( "08:00" );
      $(   "#to_time" ).val( "20:00" );
    });

  </script>
  </head>
  <body>
    <h3><font color=blue>Nmon.io Dashboard</font></h3>
    <div class="menu">
        <table>
            <tr>
              <th>
                <label for="hosts">Hosts</label>
              </th>
              <td>
                <select name="hosts" id="hosts">
                </select>
              </td>
              <td align="center"> 
                <button type="button" id="view">View</button>    
              </td>
            </tr>
            <tr>
                <td>&nbsp;</td>
                <th><label for="from">From</label></th>
                <th><label for="to"> To </label></th>
                <th width="300">Range</th>
            </tr>
            <tr>
                <th>Date</th>
                <td><input type="text" id="from" maxlength="10" size="10"></td>
                <td><input type="text" id="to" maxlength="10" size="10"></td>
                <td><div id="slider-range-date"></div></td>
            </tr>
            <tr>
                <th>Time</th>
                <td><input type="text" id="from_time" maxlength="8" size="10"</td>
                <td><input type="text" id="to_time" maxlength="8" size="10"</td>
                <td><div id="slider-range-time"></div></td>
            </tr>
        </table>

        <a href="/detail" style="float: right;">Detail</a>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>CPU</font></h4>
        <div id="cpu_chart" class="googlechart"></div>
    </div>
    <br><br><center>
          <!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- http://db.nmon.io -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-7660708060036828"
     data-ad-slot="9822759341"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </center>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>Memory</font></h4>
        <div id="mem_chart" class="googlechart"></div>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>Swap</font></h4>
        <div id="swap_chart" class="googlechart"></div>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>Disk</font></h4>
        <div id="disk_chart" class="googlechart"></div>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>Network</font></h4>
        <div id="network_chart" class="googlechart"></div>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>Process (CPU)</font></h4>
        <div id="process_cpu_chart" class="googlechart"></div>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>Process (Memory)</font></h4>
        <div id="process_mem_chart" class="googlechart"></div>
    </div>
    <div style="display: inline-block; width: 1044px;">
        <h4><font color=blue>NFS</font></h4>
        <div id="nfs_chart" class="googlechart"></div>
    </div>
    <p>
    <!-- from here test code for bubble chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <h4>Simple bubble chart test case from http://bl.ocks.org/mbostock/4063269 - mbostock's block #4063269</h4>
    <script>
var diameter = 960,
    format = d3.format(",d"),
    color = d3.scale.category20c();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5);

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");

// get process.json file
d3.json("process.json", function(error, root) {
  if (error) throw error;

  var node = svg.selectAll(".node")
      .data(bubble.nodes(classes(root))
      .filter(function(d) { return !d.children; }))
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  node.append("title")
      .text(function(d) { return d.className + ": " + format(d.value); });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return color(d.packageName); });

  node.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.className.substring(0, d.r / 3); });
});

// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");

      </script>    
    </p>
    </div>
    <!-- Nmon - reference sites --> 
    <h4><font color=blue>Nmon - reference sites...</font></h4>
    <div style="display: inline-block; width: 1044px;">
        <div id="nmon_references" class="nmon_references">
        <table widht=1024>
        <tr>
        <td valign="top">
        <p>
          <br><a target="_new" href="http://d3js.org/">d3js.org - D3 Data-Driven Documents</a>
          <br><a target="_new" href="http://bl.ocks.org/mbostock">mbostock's blocks</a>
          <br><a target="_new" href="https://github.com/mbostock/d3/wiki/Gallery">D3 gallery! by mbostock</a>
          <br><a target="_new" href="http://romsson.github.io/dragit/example/nations.html">A Re-Recreation of Gapminder's Wealth &amp; Health of Nations</a>
          <br><a target="_new" href="http://budgetapps.artzub.com/minfin/">http://budgetapps.artzub.com/minfin/</a>
          <br><a target="_new" href="https://github.com/marmelab/EventDrops#eventdrops">EventDrops - A time based / event series interactive visualization using d3.js. Use drag and zoom to navigate in time.</a>
          <br><a target="_new" href="http://bl.ocks.org/dbuezas/9306799">Animate Pie Charts with labels</a>
          <br><a target="_new" href="http://bl.ocks.org/tomerd/1499279">Google style gauges using javascript d3.js</a>
          <br><a target="_new" href="http://square.github.io/cubism/">Cubism.js - Time Series Visualization</a>
          <br><a target="_new" href="http://mbostock.github.io/d3/talk/20111018/treemap.html">d3.layout.treemap</a>
          <br><a target="_new" href="http://mbostock.github.io/d3/talk/20111116/iris-splom.html">Edgar Anderson's Iris data set scatterplot matrix</a>
          <br><a target="_new" href="http://bl.ocks.org/mbostock/4063269">Bubble Chart</a>
          <br><a target="_new" href="http://bl.ocks.org/mbostock/4061502">Box Plots</a>
          <br><a target="_new" href="http://budgetapps.artzub.com/minfin/">Russian Budget</a>
          <br><a target="_new" href="http://energia.ningunaparte.net/en/">Electric Generation in Spain - Latest 24 hours/Generation Structure</a>
          <br><a target="_new" href="">TBU...</a>
          <br><a target="_new" href="">TBU...</a>
          <br><a target="_new" href="">TBU...</a>
          <br><a target="_new" href=""></a>
          <br><a target="_new" href=""></a>
          <br><a target="_new" href=""></a>      
        </p>
        </td>
        <td alight="right"><div>
            <!-- google ad vertical for nmon - reference 300*600-->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- http://www.nmon.io - vertical -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7660708060036828"
     data-ad-slot="1049758542"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        </td></div>
        </tr>
        </table>
        </div>
    </div>
    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-65631359-3', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
